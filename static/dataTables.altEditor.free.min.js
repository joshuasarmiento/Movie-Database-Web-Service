!function(t){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(e){return t(e,window,document)}):"object"==typeof exports?module.exports=function(e,a){return e||(e=window),a&&a.fn.dataTable||(a=require("datatables.net")(e,a).$),t(a,e,e.document)}:t(jQuery,window,document)}(function(t,e,a,o){"use strict";var i=t.fn.dataTable,n=0,l=function(e,a){if(!i.versionCheck||!i.versionCheck("1.10.8"))throw"Warning: altEditor requires DataTables 1.10.8 or greater";this.c=t.extend(!0,{},i.defaults.altEditor,l.defaults,a),this.s={dt:new i.Api(e),namespace:".altEditor"+n++},this.dom={modal:t('<div class="dt-altEditor-handle"/>')},this._constructor()};return t.extend(l.prototype,{_constructor:function(){var e=this,i=this.s.dt;i.settings()[0].oInit.onAddRow&&(e.onAddRow=i.settings()[0].oInit.onAddRow),i.settings()[0].oInit.onDeleteRow&&(e.onDeleteRow=i.settings()[0].oInit.onDeleteRow),i.settings()[0].oInit.onEditRow&&(e.onEditRow=i.settings()[0].oInit.onEditRow),e.closeModalOnSuccess=i.settings()[0].oInit.closeModalOnSuccess,e.closeModalOnSuccess===o&&(e.closeModalOnSuccess=!0),e.encodeFiles=i.settings()[0].oInit.encodeFiles,e.encodeFiles===o&&(e.encodeFiles=!0),this._setup(),i.on("destroy.altEditor",function(){i.off(".altEditor"),t(i.table().body()).off(e.s.namespace),t(a.body).off(e.s.namespace)})},_setup:function(){var e=this,a=this.s.dt;this.random_id=(""+Math.random()).replace(".","");var o="altEditor-modal-"+this.random_id;this.modal_selector="#"+o,this.language=a.settings()[0].oLanguage.altEditor||{},this.language.modalClose=this.language.modalClose||"Close",this.language.edit=this.language.edit||{},this.language.edit={title:this.language.edit.title||"Edit record",button:this.language.edit.button||"Edit"},this.language.delete=this.language.delete||{},this.language.delete={title:this.language.delete.title||"Delete record",button:this.language.delete.button||"Delete"},this.language.add=this.language.add||{},this.language.add={title:this.language.add.title||"Add record",button:this.language.add.button||"Add"},this.language.success=this.language.success||"Success!",this.language.error=this.language.error||{},this.language.error={message:this.language.error.message||"There was an unknown error!",label:this.language.error.label||"Error!",responseCode:this.language.error.responseCode||"Response code: ",required:this.language.error.required||"Field is required",unique:this.language.error.unique||"Duplicated field"};var i='<div class="modal fade altEditor-modal reveal" id="'+o+'" tabindex="-1" role="dialog" data-reveal><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 style="padding-top: 1rem;padding-left: 1rem;" class="modal-title"></h4><button style="margin: initial;" type="button" class="close close-button" data-dismiss="modal" data-close aria-label="'+this.language.modalClose+'"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><p></p></div><div class="modal-footer"></div></div></div></div>';t("body").append(i),a.button("edit:name")&&a.button("edit:name").action(function(a,o,i,n){e._openEditModal(),t("#altEditor-edit-form-"+e.random_id).off("submit").on("submit",function(t){t.preventDefault(),t.stopPropagation(),e._editRowData()})}),a.button("delete:name")&&a.button("delete:name").action(function(a,o,i,n){e._openDeleteModal(),t("#altEditor-delete-form-"+e.random_id).off("submit").on("submit",function(t){t.preventDefault(),t.stopPropagation(),e._deleteRow()})}),a.button("add:name")&&a.button("add:name").action(function(a,o,i,n){e._openAddModal(),t("#altEditor-add-form-"+e.random_id).off("submit").on("submit",function(t){t.preventDefault(),t.stopPropagation(),e._addRowData()})}),t(this.modal_selector).bind("input","[data-unique]",function(o){if(null!=t(o.target).attr("data-unique")&&"false"!==t(o.target).attr("data-unique")){var i=t(o.target),n=a.column("th:contains('"+i.attr("name")+"')").data(),l=null;for(var r in null!=a.row({selected:!0}).index()&&(l=a.cell(a.row({selected:!0}).index(),a.column("th:contains('"+i.attr("name")+"')").index()).data()),o.target.setCustomValidity(""),n)i.val()==n[r]&&n[r]!=l&&o.target.setCustomValidity(e.language.error.unique)}}),this.s.dt.button("refresh:name")&&this.s.dt.button("refresh:name").action(function(t,e,a,o){e.ajax&&e.ajax.url()&&e.ajax.reload()})},_emitEvent:function(e,a){this.s.dt.iterator("table",function(o,i){t(o.nTable).triggerHandler(e+".dt",a)})},_openEditModal:function(){var e=this.s.dt.rows({selected:!0}),a=this.completeColumnDefs(),o=(this.createDialog(a,this.language.edit.title,this.language.edit.button,this.language.modalClose,"editRowBtn","altEditor-edit-form"),this.modal_selector);for(var i in a)if(null!=a[i].name){for(var n=a[i].name.toString().split("."),l=e.data()[0],r=0;r<n.length;r++)l&&(l=l[n[r]]);var d="#"+a[i].name.toString().replace(/\./g,"\\.");if(t(o).find(d).val(null!=l?l.toString().trim():null),t(o).find(d).trigger("change"),a[i].type.indexOf("checkbox")>=0&&("true"!==this._quoteattr(l)&&"1"!=this._quoteattr(l)||t(o).find(d).prop("checked",this._quoteattr(l))),a[i].type.indexOf("date")>=0&&""!==a[i].dateFormat){var s=moment(this._quoteattr(l));s&&s.isValid()&&t(o).find(d).val(s.format(a[i].dateFormat))}}t(o+" input[0]").trigger("focus"),t(o).trigger("alteditor:some_dialog_opened").trigger("alteditor:edit_dialog_opened")},_editRowData:function(){var e=this,a=this.s.dt,o={},i=a.rows({selected:!0}).data()[0];t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type!="file"]').filter(":enabled").each(function(e){o[t(this).attr("id")]=t(this).val()}),t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter("textarea").each(function(e){o[t(this).attr("id")]=t(this).val()});var n=0;t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type="file"]').each(function(a){t(this).prop("files")[0]&&(e.encodeFiles?(++n,e.getBase64(t(this).prop("files")[0],function(e){o[t(this).attr("id")]=e,--n})):o[t(this).attr("id")]=t(this).prop("files")[0])}),t('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type="checkbox"]').each(function(e){o[t(this).attr("id")]=this.checked}),console.log(o);var l=function(){0==n?e.onEditRow(e,o,function(t,a,o,i,n){e._editRowCallback(t,a,o,i,n)},function(t){e._errorCallback(t)},i):(console.log("Waiting for file base64-decoding..."),setTimeout(l,1e3))};l()},_openDeleteModal:function(){var e=this,a=this.s.dt.rows({selected:!0}),i=this.completeColumnDefs(),n="altEditor-delete-form-"+this.random_id,l="";for(var r in i)if(null!=i[r].name)if(i[r].type.indexOf("hidden")>=0)l+="<input type='hidden' id='"+i[r].title+"' value='"+a.data()[0][i[r].name]+"'></input>";else if(i[r].type.indexOf("file")<0){for(var d=i[r].name.toString().split("."),s=a.data()[0],u=0;u<d.length;u++)s&&(s=s[d[u]]);if(i[r].type.indexOf("date")>=0&&""!==i[r].dateFormat){var c=moment(a.data()[0][i[r].name]);c&&c.isValid()&&(s=c.format(i[r].dateFormat))}if(i[r].type.indexOf("select")>=0){var m=i[r].options,f=function(t){return m.length===o?t in m?m[t]:null:t};if(s instanceof Array){var g=s.map(f).filter(function(t){return null!=t});s=g.join(", ")}else s=f(s)}l+="<div style='margin-left: initial;margin-right: initial;' class='form-group row'><label for='"+e._quoteattr(i[r].name)+"'>"+i[r].title+":&nbsp</label> <input  type='hidden'  id='"+e._quoteattr(i[r].title)+"' name='"+e._quoteattr(i[r].title)+"' placeholder='"+e._quoteattr(i[r].title)+"' style='overflow:hidden'  class='form-control' value='"+e._quoteattr(s)+"' >"+s+"</input></div>"}var p=this.modal_selector;this.internalOpenDialog(p,function(){var a='<button type="button" data-content="remove" class="btn btn-default button secondary" data-close data-dismiss="modal">'+e.language.modalClose+'</button><button type="submit"  data-content="remove" class="btn btn-danger button" id="deleteRowBtn">'+e.language.delete.button+"</button>";t(p).find(".modal-title").html(e.language.delete.title),t(p).find(".modal-body").html(l),t(p).find(".modal-footer").html(a);var o=t(p).find(".modal-content");o.parent().is("form")?(o.parent().attr("name",n),o.parent().attr("id",n)):o.wrap("<form name='"+n+"' id='"+n+"' role='form'></form>")}),t(p+" input[0]").trigger("focus"),t(p).trigger("alteditor:some_dialog_opened").trigger("alteditor:delete_dialog_opened")},_deleteRow:function(){for(var t=this,e=this.s.dt,a={},o=e.rows({selected:!0}),i=0;i<e.context[0].aoColumns.length;i++){var n=e.context[0].aoColumns[i].data?e.context[0].aoColumns[i].data:e.context[0].aoColumns[i].mData?e.context[0].aoColumns[i].mData:e.context[0].aoColumns[i].idx;a[n]=o.data()[0][n]}t.onDeleteRow(t,a,function(e){t._deleteRowCallback(e)},function(e){t._errorCallback(e)})},_openAddModal:function(){this.s.dt;var e=this.completeColumnDefs(),a=(this.createDialog(e,this.language.add.title,this.language.add.button,this.language.modalClose,"addRowBtn","altEditor-add-form"),this.modal_selector);t(a+" input[0]").trigger("focus"),t(a).trigger("alteditor:some_dialog_opened").trigger("alteditor:add_dialog_opened")},completeColumnDefs:function(){var t=[],e=this.s.dt;for(var a in e.context[0].aoColumns){var o=e.context[0].aoColumns[a];t[a]={title:o.sTitle,placeholder:o.placeholder?o.placeholder:o.title,name:o.data?o.data:o.mData,type:o.type?o.type:"text",rows:o.rows?o.rows:"5",cols:o.cols?o.cols:"30",options:o.options?o.options:[],readonly:!!o.readonly&&o.readonly,disabled:!!o.disabled&&o.disabled,required:!!o.required&&o.required,msg:o.errorMsg?o.errorMsg:"",hoverMsg:o.hoverMsg?o.hoverMsg:"",pattern:o.pattern?o.pattern:".*",special:o.special?o.special:"",unique:!!o.unique&&o.unique,uniqueMsg:o.uniqueMsg?o.uniqueMsg:"",maxLength:!!o.maxLength&&o.maxLength,multiple:!!o.multiple&&o.multiple,select2:!!o.select2&&o.select2,datepicker:!!o.datepicker&&o.datepicker,datetimepicker:!!o.datetimepicker&&o.datetimepicker,editorOnChange:o.editorOnChange?o.editorOnChange:null,style:o.style?o.style:"",dateFormat:o.dateFormat?o.dateFormat:"",optionsSortByLabel:!!o.optionsSortByLabel&&o.optionsSortByLabel,inline:!!o.inline&&o.inline,step:o.step?o.step:null,min:o.min?o.min:null,max:o.max?o.max:null,value:o.value?o.value:""}}return t},createDialog:function(e,a,o,i,n,l){l=[l,this.random_id].join("-");var r="",d=0;for(var s in e)if(e[s].type.indexOf("hidden")>=0)r+="<input type='hidden' id='"+e[s].name+"' ></input>";else{if(e[s].inline?0==d?(d++,r+="<div style='margin-left: initial;margin-right: initial;' class='form-group row' id='alteditor-row-"+this._quoteattr(e[s].name)+"'>",r+="<div class='col-sm-3 col-md-3 col-lg-3 text-right' style='padding-top:4px;'>",r+="<label for='"+e[s].name+"'>"+e[s].title+":</label></div>",r+="<div class='col-sm-2 col-md-2 col-lg-2'>"):r+="<div class='col-sm-2 col-md-2 col-lg-2'>":(r+="<div style='margin-left: initial;margin-right: initial;' class='form-group row' id='alteditor-row-"+this._quoteattr(e[s].name)+"'>",r+="<div class='col-sm-3 col-md-3 col-lg-3 text-right' style='padding-top:4px;'>",r+="<label for='"+e[s].name+"'>"+e[s].title+":</label></div>",r+="<div class='col-sm-8 col-md-8 col-lg-8'>"),e[s].type.indexOf("readonly")>=0)r+="<input type='text' readonly  id='"+this._quoteattr(e[s].name)+"' name='"+this._quoteattr(e[s].title)+"' placeholder='"+this._quoteattr(e[s].placeholder?e[s].placeholder:e[s].title)+"' style='overflow:hidden'  class='form-control  form-control-sm' value=''>";else if(e[s].type.indexOf("select")>=0){var u="",c=e[s].options;if(c.length>0)for(var m=0;m<c.length;m++)u+="<option value='"+this._quoteattr(c[m])+"'>"+c[m]+"</option>";else for(var f in c)u+="<option value='"+this._quoteattr(f)+"' >"+c[f]+"</option>";r+="<select class='form-control"+(e[s].select2?" select2":"")+"' id='"+this._quoteattr(e[s].name)+"' name='"+this._quoteattr(e[s].title)+"' placeholder='"+this._quoteattr(e[s].placeholder?e[s].placeholder:e[s].title)+"' data-special='"+this._quoteattr(e[s].special)+"' data-errorMsg='"+this._quoteattr(e[s].msg)+"' data-uniqueMsg='"+this._quoteattr(e[s].uniqueMsg)+"' data-unique='"+e[s].unique+"' "+(e[s].readonly?" readonly ":"")+(e[s].disabled?" disabled ":"")+(e[s].required?" required ":"")+(e[s].multiple?" multiple ":"")+">"+u+"</select>"}else e[s].type.indexOf("textarea")>=0?r+="<textarea class='form-control' id='"+this._quoteattr(e[s].name)+"' name='"+this._quoteattr(e[s].title)+"' rows='"+this._quoteattr(e[s].rows)+"' cols='"+this._quoteattr(e[s].cols)+"' placeholder='"+this._quoteattr(e[s].placeholder?e[s].placeholder:e[s].title)+"' data-special='"+this._quoteattr(e[s].special)+"' data-errorMsg='"+this._quoteattr(e[s].msg)+"' data-uniqueMsg='"+this._quoteattr(e[s].uniqueMsg)+"' data-unique='"+e[s].unique+"' "+(e[s].readonly?" readonly ":"")+(e[s].disabled?" disabled ":"")+(e[s].required?" required ":"")+(0==e[s].maxLength?"":" maxlength='"+e[s].maxLength+"'")+" style='"+this._quoteattr(e[s].style)+"'></textarea>":r+="<input class='form-control' type='"+this._quoteattr(e[s].type)+"' id='"+this._quoteattr(e[s].name)+"' pattern='"+this._quoteattr(e[s].pattern)+"' title='"+this._quoteattr(e[s].hoverMsg)+"' name='"+this._quoteattr(e[s].title)+"' step='"+this._quoteattr(e[s].step)+"' min='"+this._quoteattr(e[s].min)+"' max='"+this._quoteattr(e[s].max)+"' value='"+this._quoteattr(e[s].value)+"' placeholder='"+this._quoteattr(e[s].placeholder?e[s].placeholder:e[s].title)+"' data-special='"+this._quoteattr(e[s].special)+"' data-errorMsg='"+this._quoteattr(e[s].msg)+"' data-uniqueMsg='"+this._quoteattr(e[s].uniqueMsg)+"' data-unique='"+e[s].unique+"' "+(e[s].readonly?" readonly ":"")+(e[s].disabled?" disabled ":"")+(e[s].required?" required ":"")+(0==e[s].maxLength?"":" maxlength='"+e[s].maxLength+"'")+" style='overflow:hidden;"+this._quoteattr(e[s].style)+"' class='form-control  form-control-sm' value=''>";r+="<label id='"+this._quoteattr(e[s].name)+"label' class='errorLabel'></label>",!e[s].inline||+s+1<e.length&&!e[+s+1].inline?r+="</div><div style='clear:both;'></div></div>":r+="</div>"}var g=this.modal_selector;this.internalOpenDialog(g,function(){var e='<button type="button" data-content="remove" class="btn btn-default button secondary" data-dismiss="modal" data-close>'+i+'</button><button type="submit" form="'+l+'" data-content="remove" class="btn btn-primary button" id="'+n+'">'+o+"</button>";t(g).find(".modal-title").html(a),t(g).find(".modal-body").html(r),t(g).find(".modal-footer").html(e);var d=t(g).find(".modal-content");d.parent().is("form")?(d.parent().attr("name",l),d.parent().attr("id",l)):d.wrap("<form name='"+l+"' id='"+l+"' role='form'></form>")}),t(g+" input[0]").trigger("focus");var p=this;for(var s in e)if(e[s].select2?t(g).find("select#"+e[s].name).select2(e[s].select2):e[s].datepicker?t(g).find("#"+e[s].name).datepicker(e[s].datepicker):e[s].datetimepicker&&t(g).find("#"+e[s].name).datetimepicker(e[s].datetimepicker),e[s].editorOnChange&&(t(g).find("#"+t.escapeSelector(e[s].name)).attr("alt-editor-id",this._quoteattr(s)),t(g).find("#"+t.escapeSelector(e[s].name)).on("change",function(a){(0,e[t(this).attr("alt-editor-id")].editorOnChange)(a,p)})),e[s].type.indexOf("select")>=0&&e[s].optionsSortByLabel){var h="#"+e[s].name.toString().replace(/\./g,"\\."),v=t(g).find(h).find("option");v.sort(function(e,a){return t(e).text()>t(a).text()?1:-1}),t(g).find(h).html("").append(v),t(g).find(h).val(t(h+" option:first").val())}},_addRowData:function(){var e=this,a=(this.s.dt,{});t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type!="file"]').filter(":enabled").each(function(e){a[t(this).attr("id")]=t(this).val()}),t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter("textarea").each(function(e){a[t(this).attr("id")]=t(this).val()});var o=0;t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type="file"]').each(function(i){t(this).prop("files")[0]&&(e.encodeFiles?(++o,e.getBase64(t(this).prop("files")[0],function(e){a[t(this).attr("id")]=e,--o})):a[t(this).attr("id")]=t(this).prop("files")[0])}),t('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type="checkbox"]').each(function(e){a[t(this).attr("id")]=this.checked}),console.log(a);var i=function(){0==o?e.onAddRow(e,a,function(t){e._addRowCallback(t)},function(t){e._errorCallback(t)}):(console.log("Waiting for file base64-decoding..."),setTimeout(i,1e3))};i()},_deleteRowCallback:function(e,a,o){var i=this.modal_selector;if(t(i+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(i);else{var n='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(i+" .modal-body").append(n)}this.s.dt.row({selected:!0}).remove(),this.s.dt.draw("page"),t("div"+i).find("button#addRowBtn").prop("disabled",!0),t("div"+i).find("button#editRowBtn").prop("disabled",!0),t("div"+i).find("button#deleteRowBtn").prop("disabled",!0)},_addRowCallback:function(e,a,o){var i="string"==typeof e?JSON.parse(e):e,n=this.modal_selector;if(t(n+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(n);else{var l='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(n+" .modal-body").append(l)}this.s.dt.row.add(i).draw(!1),t("div"+n).find("button#addRowBtn").prop("disabled",!0),t("div"+n).find("button#editRowBtn").prop("disabled",!0),t("div"+n).find("button#deleteRowBtn").prop("disabled",!0)},_editRowCallback:function(e,a,o){var i="string"==typeof e?JSON.parse(e):e,n=this.modal_selector;if(t(n+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(n);else{var l='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(n+" .modal-body").append(l)}this.s.dt.row({selected:!0}).data(i),this.s.dt.draw("page"),t("div"+n).find("button#addRowBtn").prop("disabled",!0),t("div"+n).find("button#editRowBtn").prop("disabled",!0),t("div"+n).find("button#deleteRowBtn").prop("disabled",!0)},_errorCallback:function(e,a,o){var i=e,n=this.modal_selector;t(n+" .modal-body .alert").remove();var l=this.language.error.message;if(i.responseJSON&&i.responseJSON.errors)for(var r in l="",i.responseJSON.errors)l+=i.responseJSON.errors[r][0];var d='<div class="alert alert-danger" role="alert"><strong>'+this.language.error.label+"</strong> "+(null==i.status?"":this.language.error.responseCode+i.status)+" "+l+"</div>";t(n+" .modal-body").append(d)},onAddRow:function(t,e,a,o){console.log("Missing AJAX configuration for INSERT"),a(e)},onEditRow:function(t,e,a,o){console.log("Missing AJAX configuration for UPDATE"),a(e)},onDeleteRow:function(t,e,a,o){console.log("Missing AJAX configuration for DELETE"),a(e)},internalOpenDialog(e,a){var o=t(e);if(o.modal)o.on("show.bs.modal",a),o.modal("show");else{if(!o.foundation)return void console.error("You must load Bootstrap or Foundation in order to open modal dialogs");o.on("open.zf.reveal",a),o.on("closed.zf.reveal",function(){t(".reveal-overlay").hide()}),new Foundation.Reveal(o).open()}},internalCloseDialog(e){var a=t(e);if(a.modal)a.modal("hide");else{if(!a.foundation)return void console.error("You must load Bootstrap or Foundation in order to open modal dialogs");new Foundation.Reveal(a).close(),t(".reveal-overlay").hide()}},reloadOptions:function(e,a){var o=e.val();e.empty(),a.length>0?t.each(a,function(a,o){e.append(t("<option></option>").attr("value",o).text(o))}):t.each(a,function(a,o){e.append(t("<option></option>").attr("value",o).text(a))}),e.val(o),e.trigger("change")},getBase64:function(t,e,a){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){console.log(o.result),e&&e(o.result)},o.onerror=function(t){console.log("Error: ",t),a&&a(t)}},_quoteattr:function(t,e){if(null==t)return"";if(e=e?"&#13;":"\n",Array.isArray(t)){var a,o=[];for(a in t)o.push(t[a]);return o}return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,e).replace(/[\r\n]/g,e)}}),l.version="2.0",l.defaults={alwaysAsk:!1,focus:null,columns:"",update:null,editor:null},l.classes={btn:"btn"},t(a).on("preInit.dt.altEditor",function(e,a,o){if("dt"===e.namespace){var n=a.oInit.altEditor,r=i.defaults.altEditor;if(n||r){var d=t.extend({},n,r);if(!1!==n){var s=new l(a,d);e.target.altEditor=s}}}}),i.altEditor=l,l});